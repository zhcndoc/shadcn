---
title: Next.js 15 + React 19
description: 在 Next.js 15 和 React 19 中使用 shadcn/ui。
---

<Callout className="mb-6 border-blue-600 bg-blue-50 dark:border-blue-900 dark:bg-blue-950 [&_code]:bg-blue-100 dark:[&_code]:bg-blue-900">
  **更新：** 我们在 `canary` 版本中已添加对 React 19 和 Tailwind v4 的全面支持。详情请参见 
  [Tailwind v4](/docs/tailwind-v4) 文档。
</Callout>

<Callout>
  **以下指南适用于所有支持 React 19 的框架。** 我将此页面命名为 “Next.js 15 + React 19”，是为了方便升级到 Next.js 15 的用户查找。我们正在与包维护者合作，帮助他们升级到 React 19。
</Callout>

## 精简总结（TL;DR）

如果你使用 `npm`，可以通过添加标志来安装 shadcn/ui 的依赖。在运行 `shadcn` CLI 时，会提示你选择一个标志。使用 pnpm、bun 或 yarn 则无需添加标志。

有关每个包对 React 19 支持的状态，请参阅 [升级状态](#upgrade-status)。

## 发生了什么？

React 19 现已为 [rc 版本](https://www.npmjs.com/package/react?activeTab=versions) ，并且已在最新版 Next.js 15 中[测试并支持](https://nextjs.org/blog/next-15#react-19)。

为了支持 React 19，包维护者需要测试并更新他们的包，将 React 19 作为 peer dependency 添加进来。这项工作已经在[进行中](https://github.com/radix-ui/primitives/pull/2952)、[进行中](https://github.com/pacocoursey/cmdk/pull/318) 和[进行中](https://github.com/emilkowalski/vaul/pull/498)。

```diff /^19.0/
"peerDependencies": {
-  "react": "^16.8 || ^17.0 || ^18.0",
+  "react": "^16.8 || ^17.0 || ^18.0 || ^19.0",
-  "react-dom": "^16.8 || ^17.0 || ^18.0"
+  "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0"
},
```

<Callout>
  你可以通过运行 `npm info <package> peerDependencies` 来检查包是否已将 React 19 列为 peer dependency。
</Callout>

与此同时，如果你安装的包 **未** 将 React 19 列为 peer dependency，会看到类似如下的错误信息：

```bash
npm error code ERESOLVE
npm error ERESOLVE unable to resolve dependency tree
npm error
npm error While resolving: my-app@0.1.0
npm error Found: react@19.0.0-rc-69d4b800-20241021
npm error node_modules/react
npm error   react@"19.0.0-rc-69d4b800-20241021" from the root project
```

<Callout>
  **注意：** 这仅在 npm 中出现。PNPM 和 Bun 只会显示静默警告。
</Callout>

## 如何解决

### 方案一：`--force` 或 `--legacy-peer-deps`

你可以使用 `--force` 或 `--legacy-peer-deps` 标志强制安装包：

```bash
npm i <package> --force

npm i <package> --legacy-peer-deps
```

这将安装包并忽略 peer dependency 警告。

<Accordion type="multiple">
  <AccordionItem value="flags">
    <AccordionTrigger className="font-medium">
      `--force` 和 `--legacy-peer-deps` 标志的作用是什么？
    </AccordionTrigger>
    <AccordionContent className="[&_ul]:mt-0">

      - `--force`：忽略并覆盖所有依赖冲突，强制安装包。
      - `--legacy-peer-deps`：跳过严格的 peer dependency 检查，允许安装未满足 peer dependencies 的包，以避免错误。

    </AccordionContent>

  </AccordionItem>
</Accordion>

### 方案二：使用 React 18

你可以将 `react` 和 `react-dom` 降级到版本 18，这样就与所安装的包兼容，等依赖更新后再升级。

```bash
npm i react@18 react-dom@18
```

无论选择哪种方案，请务必充分测试你的应用，确保不会出现回归问题。

## 在 Next.js 15 上使用 shadcn/ui

### 使用 pnpm、bun 或 yarn

请按照[安装指南](/docs/installation/next)中的步骤安装 shadcn/ui，无需任何标志。

### 使用 npm

当你运行 `npx shadcn@latest init -d` 时，会提示你选择一种方式以解决 peer dependency 问题：

```bash
It looks like you are using React 19.
Some packages may fail to install due to peer dependency issues (see https://ui.shadcn.com/react-19).

? How would you like to proceed? › - Use arrow-keys. Return to submit.
❯   Use --force
    Use --legacy-peer-deps
```

接着，你可以使用选择的标志运行该命令。

## 添加组件

添加组件的流程与上述相同。请选择一个标志来解决 peer dependency 问题。

**请记得每次安装新依赖后，务必测试你的应用。**

## 升级状态

为了方便你跟踪升级进度，我制作了下面的表格，列出了 shadcn/ui 依赖包对 React 19 的支持状态。

- ✅ - 使用 npm、pnpm 和 bun 均支持 React 19。
- 🚧 - 使用 pnpm 和 bun 支持 React 19。npm 需要添加标志。相关 PR 正在进行中。

| 包名                                                                              | 状态   | 备注                                                         |
| --------------------------------------------------------------------------------- | ------ | ------------------------------------------------------------ |
| [radix-ui](https://www.npmjs.com/package/@radix-ui/react-icons)                    | ✅     |                                                              |
| [lucide-react](https://www.npmjs.com/package/lucide-react)                         | ✅     |                                                              |
| [class-variance-authority](https://www.npmjs.com/package/class-variance-authority) | ✅     | 未将 React 19 列为 peer dependency。                          |
| [tailwindcss-animate](https://www.npmjs.com/package/tailwindcss-animate)           | ✅     | 未将 React 19 列为 peer dependency。                          |
| [embla-carousel-react](https://www.npmjs.com/package/embla-carousel-react)         | ✅     |                                                              |
| [recharts](https://www.npmjs.com/package/recharts)                                 | ✅     | 见下文[说明](#recharts)                                     |
| [react-hook-form](https://www.npmjs.com/package/react-hook-form)                   | ✅     |                                                              |
| [react-resizable-panels](https://www.npmjs.com/package/react-resizable-panels)     | ✅     |                                                              |
| [sonner](https://www.npmjs.com/package/sonner)                                     | ✅     |                                                              |
| [react-day-picker](https://www.npmjs.com/package/react-day-picker)                 | ✅     | npm 需要添加标志支持。升级到 v9 的工作正在进行中。            |
| [input-otp](https://www.npmjs.com/package/input-otp)                               | ✅     |                                                              |
| [vaul](https://www.npmjs.com/package/vaul)                                         | ✅     |                                                              |
| [@radix-ui/react-icons](https://www.npmjs.com/package/@radix-ui/react-icons)       | 🚧     | 见[PR #194](https://github.com/radix-ui/icons/pull/194)       |
| [cmdk](https://www.npmjs.com/package/cmdk)                                         | ✅     |                                                              |

如果你有任何问题，请在 GitHub 上[提交 issue](https://github.com/shadcn/ui/issues)。

## Recharts

要在 React 19 中使用 recharts，你需要重写 `react-is` 依赖。

<Steps>

<Step>在你的 `package.json` 中添加如下内容：</Step>

```json title="package.json"
"overrides": {
  "react-is": "^19.0.0-rc-69d4b800-20241021"
}
```

注意：`react-is` 的版本需要与你使用的 React 19 版本相匹配，上述为示例。

<Step>运行 `npm install --legacy-peer-deps`</Step>

</Steps>