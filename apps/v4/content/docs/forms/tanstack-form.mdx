---
title: TanStack Form
description: 使用 TanStack Form 和 Zod 在 React 中构建表单。
links:
  doc: https://tanstack.com/form
---

import { InfoIcon } from "lucide-react"

本指南将探索如何使用 TanStack Form 构建表单。您将学习如何使用 `<Field />` 组件创建表单，使用 Zod 实现模式验证，处理错误，以及确保无障碍性。

## 演示

我们将从构建以下表单开始。它包含一个简单的文本输入框和一个多行文本框。在提交时，我们将验证表单数据并显示任何错误。

<Callout icon={<InfoIcon />}>
  **注意：**为了演示目的，我们故意禁用了浏览器验证，以展示 TanStack Form 中模式验证和表单错误的工作原理。建议在生产代码中添加基础的浏览器验证。
</Callout>

<ComponentPreview
  name="form-tanstack-demo"
  className="sm:[&_.preview]:h-[700px] sm:[&_pre]:!h-[700px]"
  chromeLessOnMobile
/>

## 方法

此表单利用 TanStack Form 进行强大且无头的表单处理。我们将使用 `<Field />` 组件构建表单，这为您提供了**对标记和样式的完全控制**。

- 使用 TanStack Form 的 `useForm` 钩子进行表单状态管理。
- 使用 `form.Field` 组件及渲染属性模式实现受控输入。
- 使用 `<Field />` 组件构建无障碍表单。
- 使用 Zod 进行客户端验证。
- 实时验证反馈。

## 结构解析

下面是一个使用 TanStack Form 和 `<Field />` 组件的基本表单示例。

```tsx showLineNumbers {15-31}
<form
  onSubmit={(e) => {
    e.preventDefault()
    form.handleSubmit()
  }}
>
  <FieldGroup>
    <form.Field
      name="title"
      children={(field) => {
        const isInvalid =
          field.state.meta.isTouched && !field.state.meta.isValid
        return (
          <Field data-invalid={isInvalid}>
            <FieldLabel htmlFor={field.name}>Bug Title</FieldLabel>
            <Input
              id={field.name}
              name={field.name}
              value={field.state.value}
              onBlur={field.handleBlur}
              onChange={(e) => field.handleChange(e.target.value)}
              aria-invalid={isInvalid}
              placeholder="Login button not working on mobile"
              autoComplete="off"
            />
            <FieldDescription>
              Provide a concise title for your bug report.
            </FieldDescription>
            {isInvalid && <FieldError errors={field.state.meta.errors} />}
          </Field>
        )
      }}
    />
  </FieldGroup>
  <Button type="submit">Submit</Button>
</form>
```

## 表单

### 创建模式

我们将先使用 Zod 模式定义表单的结构。

<Callout icon={<InfoIcon />}>
  **注意：**本示例使用 `zod v3` 进行模式验证。TanStack Form 能够通过其验证器 API 与 Zod 及其他标准模式验证库无缝集成。
</Callout>

```tsx showLineNumbers title="form.tsx"
import * as z from "zod"

const formSchema = z.object({
  title: z
    .string()
    .min(5, "Bug title must be at least 5 characters.")
    .max(32, "Bug title must be at most 32 characters."),
  description: z
    .string()
    .min(20, "Description must be at least 20 characters.")
    .max(100, "Description must be at most 100 characters."),
})
```

### 设置表单

使用 TanStack Form 的 `useForm` 钩子创建带有 Zod 验证的表单实例。

```tsx showLineNumbers title="form.tsx" {10-21}
import { useForm } from "@tanstack/react-form"
import { toast } from "sonner"
import * as z from "zod"

const formSchema = z.object({
  // ...
})

export function BugReportForm() {
  const form = useForm({
    defaultValues: {
      title: "",
      description: "",
    },
    validators: {
      onSubmit: formSchema,
    },
    onSubmit: async ({ value }) => {
      toast.success("Form submitted successfully")
    },
  })

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault()
        form.handleSubmit()
      }}
    >
      {/* ... */}
    </form>
  )
}
```

这里我们使用 `onSubmit` 来验证表单数据。TanStack Form 支持其他验证模式，您可以在[文档](https://tanstack.com/form/latest/docs/framework/react/guides/dynamic-validation)中了解详情。

### 构建表单

现在可以使用 TanStack Form 的 `form.Field` 组件和 `<Field />` 组件构建表单。

<ComponentSource
  src="/registry/new-york-v4/examples/form-tanstack-demo.tsx"
  title="form.tsx"
/>

### 完成

到这里，您就拥有了一个具备客户端验证的完整无障碍表单。

当提交表单时，`onSubmit` 函数将使用验证后的表单数据被调用。如果表单数据无效，TanStack Form 会在每个字段旁边显示错误信息。

## 验证

### 客户端验证

TanStack Form 使用 Zod 模式验证表单数据。验证随用户输入实时进行。

```tsx showLineNumbers title="form.tsx" {13-15}
import { useForm } from "@tanstack/react-form"

const formSchema = z.object({
  // ...
})

export function BugReportForm() {
  const form = useForm({
    defaultValues: {
      title: "",
      description: "",
    },
    validators: {
      onSubmit: formSchema,
    },
    onSubmit: async ({ value }) => {
      console.log(value)
    },
  })

  return <form onSubmit={/* ... */}>{/* ... */}</form>
}
```

### 验证模式

TanStack Form 通过 `validators` 选项支持不同的验证策略：

| 模式          | 描述                             |
| ------------- | -------------------------------- |
| `"onChange"`  | 每次更改时触发验证               |
| `"onBlur"`    | 失焦时触发验证                   |
| `"onSubmit"`  | 提交时触发验证                   |

```tsx showLineNumbers title="form.tsx" {6-9}
const form = useForm({
  defaultValues: {
    title: "",
    description: "",
  },
  validators: {
    onSubmit: formSchema,
    onChange: formSchema,
    onBlur: formSchema,
  },
})
```

## 显示错误

使用 `<FieldError />` 在字段旁显示错误。为样式和无障碍支持：

- 给 `<Field />` 组件添加 `data-invalid` 属性。
- 给表单控件（如 `<Input />`、`<SelectTrigger />`、`<Checkbox />` 等）添加 `aria-invalid` 属性。

```tsx showLineNumbers title="form.tsx" {4,18}
<form.Field
  name="email"
  children={(field) => {
    const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid

    return (
      <Field data-invalid={isInvalid}>
        <FieldLabel htmlFor={field.name}>Email</FieldLabel>
        <Input
          id={field.name}
          name={field.name}
          value={field.state.value}
          onBlur={field.handleBlur}
          onChange={(e) => field.handleChange(e.target.value)}
          type="email"
          aria-invalid={isInvalid}
        />
        {isInvalid && <FieldError errors={field.state.meta.errors} />}
      </Field>
    )
  }}
/>
```

## 处理不同类型的字段

### 输入框（Input）

- 输入框使用 `<Input />` 组件的 `field.state.value` 和 `field.handleChange`。
- 显示错误时，在 `<Input />` 组件添加 `aria-invalid` 属性，在 `<Field />` 组件添加 `data-invalid` 属性。

<ComponentPreview
  name="form-tanstack-input"
  className="sm:[&_.preview]:h-[700px] sm:[&_pre]:!h-[700px]"
  chromeLessOnMobile
/>

```tsx showLineNumbers title="form.tsx" {6,11-14,22}
<form.Field
  name="username"
  children={(field) => {
    const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid
    return (
      <Field data-invalid={isInvalid}>
        <FieldLabel htmlFor="form-tanstack-input-username">Username</FieldLabel>
        <Input
          id="form-tanstack-input-username"
          name={field.name}
          value={field.state.value}
          onBlur={field.handleBlur}
          onChange={(e) => field.handleChange(e.target.value)}
          aria-invalid={isInvalid}
          placeholder="shadcn"
          autoComplete="username"
        />
        <FieldDescription>
          This is your public display name. Must be between 3 and 10 characters.
          Must only contain letters, numbers, and underscores.
        </FieldDescription>
        {isInvalid && <FieldError errors={field.state.meta.errors} />}
      </Field>
    )
  }}
/>
```

### 多行文本框（Textarea）

- 多行文本使用 `<Textarea />` 组件的 `field.state.value` 和 `field.handleChange`。
- 显示错误时，在 `<Textarea />` 组件添加 `aria-invalid` 属性，在 `<Field />` 组件添加 `data-invalid` 属性。

<ComponentPreview
  name="form-tanstack-textarea"
  className="sm:[&_.preview]:h-[700px] sm:[&_pre]:!h-[700px]"
  chromeLessOnMobile
/>

```tsx showLineNumbers title="form.tsx" {6,13-16,24}
<form.Field
  name="about"
  children={(field) => {
    const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid
    return (
      <Field data-invalid={isInvalid}>
        <FieldLabel htmlFor="form-tanstack-textarea-about">
          More about you
        </FieldLabel>
        <Textarea
          id="form-tanstack-textarea-about"
          name={field.name}
          value={field.state.value}
          onBlur={field.handleBlur}
          onChange={(e) => field.handleChange(e.target.value)}
          aria-invalid={isInvalid}
          placeholder="I'm a software engineer..."
          className="min-h-[120px]"
        />
        <FieldDescription>
          Tell us more about yourself. This will be used to help us personalize
          your experience.
        </FieldDescription>
        {isInvalid && <FieldError errors={field.state.meta.errors} />}
      </Field>
    )
  }}
/>
```

### 选择框（Select）

- 选择框在 `<Select />` 组件上使用 `field.state.value` 和 `field.handleChange`。
- 显示错误时，在 `<SelectTrigger />` 组件添加 `aria-invalid` 属性，在 `<Field />` 组件添加 `data-invalid` 属性。

<ComponentPreview
  name="form-tanstack-select"
  className="sm:[&_.preview]:h-[700px] sm:[&_pre]:!h-[700px]"
  chromeLessOnMobile
/>

```tsx showLineNumbers title="form.tsx" {6,18-19,23}
<form.Field
  name="language"
  children={(field) => {
    const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid
    return (
      <Field orientation="responsive" data-invalid={isInvalid}>
        <FieldContent>
          <FieldLabel htmlFor="form-tanstack-select-language">
            Spoken Language
          </FieldLabel>
          <FieldDescription>
            For best results, select the language you speak.
          </FieldDescription>
          {isInvalid && <FieldError errors={field.state.meta.errors} />}
        </FieldContent>
        <Select
          name={field.name}
          value={field.state.value}
          onValueChange={field.handleChange}
        >
          <SelectTrigger
            id="form-tanstack-select-language"
            aria-invalid={isInvalid}
            className="min-w-[120px]"
          >
            <SelectValue placeholder="Select" />
          </SelectTrigger>
          <SelectContent position="item-aligned">
            <SelectItem value="auto">Auto</SelectItem>
            <SelectItem value="en">English</SelectItem>
          </SelectContent>
        </Select>
      </Field>
    )
  }}
/>
```

### 复选框（Checkbox）

- 复选框使用 `<Checkbox />` 组件的 `field.state.value` 和 `field.handleChange`。
- 显示错误时，在 `<Checkbox />` 组件添加 `aria-invalid` 属性，在 `<Field />` 组件添加 `data-invalid` 属性。
- 对于复选框数组，在 `<form.Field />` 组件上使用 `mode="array"`，并使用 TanStack Form 的数组辅助功能。
- 别忘了给 `<FieldGroup />` 组件添加 `data-slot="checkbox-group"` 以实现正确的样式和间距。

<ComponentPreview
  name="form-tanstack-checkbox"
  className="sm:[&_.preview]:h-[700px] sm:[&_pre]:!h-[700px]"
  chromeLessOnMobile
/>

```tsx showLineNumbers title="form.tsx" {12,17,22-24,44}
<form.Field
  name="tasks"
  mode="array"
  children={(field) => {
    const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid
    return (
      <FieldSet>
        <FieldLegend variant="label">Tasks</FieldLegend>
        <FieldDescription>
          Get notified when tasks you&apos;ve created have updates.
        </FieldDescription>
        <FieldGroup data-slot="checkbox-group">
          {tasks.map((task) => (
            <Field
              key={task.id}
              orientation="horizontal"
              data-invalid={isInvalid}
            >
              <Checkbox
                id={`form-tanstack-checkbox-${task.id}`}
                name={field.name}
                aria-invalid={isInvalid}
                checked={field.state.value.includes(task.id)}
                onCheckedChange={(checked) => {
                  if (checked) {
                    field.pushValue(task.id)
                  } else {
                    const index = field.state.value.indexOf(task.id)
                    if (index > -1) {
                      field.removeValue(index)
                    }
                  }
                }}
              />
              <FieldLabel
                htmlFor={`form-tanstack-checkbox-${task.id}`}
                className="font-normal"
              >
                {task.label}
              </FieldLabel>
            </Field>
          ))}
        </FieldGroup>
        {isInvalid && <FieldError errors={field.state.meta.errors} />}
      </FieldSet>
    )
  }}
/>
```

### 单选组（Radio Group）

- 单选组在 `<RadioGroup />` 组件上使用 `field.state.value` 和 `field.handleChange`。
- 显示错误时，在 `<RadioGroupItem />` 组件添加 `aria-invalid` 属性，在 `<Field />` 组件添加 `data-invalid` 属性。

<ComponentPreview
  name="form-tanstack-radiogroup"
  className="sm:[&_.preview]:h-[700px] sm:[&_pre]:!h-[700px]"
  chromeLessOnMobile
/>

```tsx showLineNumbers title="form.tsx" {21,29,35}
<form.Field
  name="plan"
  children={(field) => {
    const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid
    return (
      <FieldSet>
        <FieldLegend>Plan</FieldLegend>
        <FieldDescription>
          You can upgrade or downgrade your plan at any time.
        </FieldDescription>
        <RadioGroup
          name={field.name}
          value={field.state.value}
          onValueChange={field.handleChange}
        >
          {plans.map((plan) => (
            <FieldLabel
              key={plan.id}
              htmlFor={`form-tanstack-radiogroup-${plan.id}`}
            >
              <Field orientation="horizontal" data-invalid={isInvalid}>
                <FieldContent>
                  <FieldTitle>{plan.title}</FieldTitle>
                  <FieldDescription>{plan.description}</FieldDescription>
                </FieldContent>
                <RadioGroupItem
                  value={plan.id}
                  id={`form-tanstack-radiogroup-${plan.id}`}
                  aria-invalid={isInvalid}
                />
              </Field>
            </FieldLabel>
          ))}
        </RadioGroup>
        {isInvalid && <FieldError errors={field.state.meta.errors} />}
      </FieldSet>
    )
  }}
/>
```

### 开关（Switch）

- 开关在 `<Switch />` 组件上使用 `field.state.value` 和 `field.handleChange`。
- 显示错误时，在 `<Switch />` 组件添加 `aria-invalid` 属性，在 `<Field />` 组件添加 `data-invalid` 属性。

<ComponentPreview
  name="form-tanstack-switch"
  className="sm:[&_.preview]:h-[500px] sm:[&_pre]:!h-[500px]"
  chromeLessOnMobile
/>

```tsx showLineNumbers title="form.tsx" {6,14,19-21}
<form.Field
  name="twoFactor"
  children={(field) => {
    const isInvalid = field.state.meta.isTouched && !field.state.meta.isValid
    return (
      <Field orientation="horizontal" data-invalid={isInvalid}>
        <FieldContent>
          <FieldLabel htmlFor="form-tanstack-switch-twoFactor">
            Multi-factor authentication
          </FieldLabel>
          <FieldDescription>
            Enable multi-factor authentication to secure your account.
          </FieldDescription>
          {isInvalid && <FieldError errors={field.state.meta.errors} />}
        </FieldContent>
        <Switch
          id="form-tanstack-switch-twoFactor"
          name={field.name}
          checked={field.state.value}
          onCheckedChange={field.handleChange}
          aria-invalid={isInvalid}
        />
      </Field>
    )
  }}
/>
```

### 复杂表单

下面是一个包含多个字段和验证的更复杂表单示例。

<ComponentPreview
  name="form-tanstack-complex"
  className="sm:[&_.preview]:h-[1100px] sm:[&_pre]:!h-[1100px]"
  chromeLessOnMobile
/>

## 重置表单

使用 `form.reset()` 重置表单到默认值。

```tsx showLineNumbers
<Button type="button" variant="outline" onClick={() => form.reset()}>
  Reset
</Button>
```

## 数组字段

TanStack Form 提供使用 `mode="array"` 的强大数组字段管理功能。您可以动态添加、移除及更新数组项，并支持完整的验证。

<ComponentPreview
  name="form-tanstack-array"
  className="sm:[&_.preview]:h-[700px] sm:[&_pre]:!h-[700px]"
  chromeLessOnMobile
/>

该示例演示了如何使用数组字段管理多个电子邮件地址。用户最多可添加 5 个邮箱地址，且可删除单个地址，每个地址独立验证。

### 数组字段结构

在父字段上使用 `mode="array"` 启用数组字段管理。

```tsx showLineNumbers title="form.tsx" {3,12-14}
<form.Field
  name="emails"
  mode="array"
  children={(field) => {
    return (
      <FieldSet>
        <FieldLegend variant="label">Email Addresses</FieldLegend>
        <FieldDescription>
          Add up to 5 email addresses where we can contact you.
        </FieldDescription>
        <FieldGroup>
          {field.state.value.map((_, index) => (
            // 嵌套字段对应数组中的每个项目
          ))}
        </FieldGroup>
      </FieldSet>
    )
  }}
/>
```

### 嵌套字段

使用括号语法访问单个数组项：`fieldName[index].propertyName`。此示例使用 `InputGroup` 实现删除按钮与输入框的同排显示。

```tsx showLineNumbers title="form.tsx"
<form.Field
  name={`emails[${index}].address`}
  children={(subField) => {
    const isSubFieldInvalid =
      subField.state.meta.isTouched && !subField.state.meta.isValid
    return (
      <Field orientation="horizontal" data-invalid={isSubFieldInvalid}>
        <FieldContent>
          <InputGroup>
            <InputGroupInput
              id={`form-tanstack-array-email-${index}`}
              name={subField.name}
              value={subField.state.value}
              onBlur={subField.handleBlur}
              onChange={(e) => subField.handleChange(e.target.value)}
              aria-invalid={isSubFieldInvalid}
              placeholder="name@example.com"
              type="email"
            />
            {field.state.value.length > 1 && (
              <InputGroupAddon align="inline-end">
                <InputGroupButton
                  type="button"
                  variant="ghost"
                  size="icon-xs"
                  onClick={() => field.removeValue(index)}
                  aria-label={`Remove email ${index + 1}`}
                >
                  <XIcon />
                </InputGroupButton>
              </InputGroupAddon>
            )}
          </InputGroup>
          {isSubFieldInvalid && (
            <FieldError errors={subField.state.meta.errors} />
          )}
        </FieldContent>
      </Field>
    )
  }}
/>
```

### 添加项目

使用 `field.pushValue(item)` 向数组字段添加项目。可在数组达到最大长度时禁用按钮。

```tsx showLineNumbers title="form.tsx"
<Button
  type="button"
  variant="outline"
  size="sm"
  onClick={() => field.pushValue({ address: "" })}
  disabled={field.state.value.length >= 5}
>
  Add Email Address
</Button>
```

### 移除项目

使用 `field.removeValue(index)` 从数组字段中移除项目。可在项目数多于一项时有条件显示删除按钮。

```tsx showLineNumbers title="form.tsx"
{
  field.state.value.length > 1 && (
    <InputGroupButton
      onClick={() => field.removeValue(index)}
      aria-label={`Remove email ${index + 1}`}
    >
      <XIcon />
    </InputGroupButton>
  )
}
```

### 数组验证

使用 Zod 的数组方法验证数组字段。

```tsx showLineNumbers title="form.tsx"
const formSchema = z.object({
  emails: z
    .array(
      z.object({
        address: z.string().email("Enter a valid email address."),
      })
    )
    .min(1, "Add at least one email address.")
    .max(5, "You can add up to 5 email addresses."),
})
```